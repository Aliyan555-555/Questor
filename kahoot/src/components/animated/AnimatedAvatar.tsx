"use client";

import Image from "next/image";
import React, {useState } from "react";

interface AvatarData {
  id: string;
  resource: string;
  colors: {
    chinColor: string;
    mouthColor: string;
    tongueColor: string;
    teethColor: string;
    eyeBorderColor:string;
    pupilColor:string;
    eyeballColor:string;
    eyebrowColor:string;
    bodyColor:string;
  };
}

interface AvatarItems {
  id: string;
  resource: string;
}

interface AnimatedAvatarProps {
  avatarData: AvatarData;
  avatarItems?: AvatarItems;
  w?: string;
  h?: string;
  bg?: string;
  chin?: boolean; 
}

const AnimatedAvatar: React.FC<AnimatedAvatarProps> = ({
  avatarData,
  avatarItems,
  w = "128px",
  h = "128px",
  bg = "#46178F",
  chin = true,
}) => {
  const [loading, setLoading] = useState(true);

  return (
    <div
      style={{ width: w, height: h, backgroundColor: bg }}
      className="overflow-hidden relative rounded-lg"
    >
      {loading && <div className="absolute inset-0 flex items-center justify-center">Loading...</div>}
      <div className="animation relative z-10">
        <Image
          width={200}
          height={200}
          src={avatarData.resource}
          alt="Avatar"
          className="w-full h-full relative z-10"
          onLoadingComplete={() => setLoading(false)}
        />
        {avatarItems && (
          <Image
            width={200}
            height={200}
            src={avatarItems.resource}
            alt="Item"
            className="absolute w-full h-full top-0 left-0"
            style={{ zIndex: 1000 }}
          />
        )}
        {/* SVG Rendering */}
        <div className="absolute w-full h-full top-0 left-0 z-10">
        <svg
            xmlns="http://www.w3.org/2000/svg"
            xmlnsXlink="http://www.w3.org/1999/xlink"
            viewBox="0 0 800 800"
            width="800"
            height="800"
            preserveAspectRatio="xMidYMid meet"
            style={{
              width: "100%",
              height: "100%",
              transform: "translate3d(0px, 0px, 0px)",
              contentVisibility: "visible",
            }}
          >
            <defs>
              <clipPath id="__lottie_element_316">
                <rect width="800" height="800" x="0" y="0"></rect>
              </clipPath>
              <clipPath id="__lottie_element_327">
                <path
                  fill="#fef4"
                  clipRule="nonzero"
                  d=" M291.6580810546875,625.9271240234375 C291.6580810546875,625.9271240234375 396.558837890625,660.1946411132812 509.221923828125,624.3051147460938 C509.221923828125,624.3051147460938 496.1120300292969,709.4646606445312 402.8821105957031,709.986328125 C300.0061950683594,710.5104370117188 291.6580810546875,625.9271240234375 291.6580810546875,625.9271240234375"
                  fillOpacity="1"
                ></path>
              </clipPath>
            </defs>
            <g clipPath="url(#__lottie_element_316)">
              <g
                transform="matrix(1,0,0,1,0,0)"
                opacity="1"
                style={{ display: "block" }}
              >
                <g
                  opacity="1"
                  transform="matrix(1.0553499460220337,0,0,1,400.02899169921875,737.6279907226562)"
                >
                  <path
                    className="chin_color"
                    fill={avatarData.colors.chinColor}
                    fillOpacity="1"
                    d=" M0,4.513402938842773 C0,4.513402938842773 -32.347991943359375,6.4614481925964355 -53.02379608154297,-15.411515235900879 C-53.02379608154297,-15.411515235900879 -39.595001220703125,19.295671463012695 0,19.295671463012695 C39.595001220703125,19.295671463012695 52.994041442871094,-15.411515235900879 52.994041442871094,-15.411515235900879 C33.889041900634766,5.741537570953369 0,4.513402938842773 0,4.513402938842773z"
                  ></path>
                </g>
              </g>
              <g
                clipPath="url(#__lottie_element_327)"
                transform="matrix(1,0,0,1,0,0)"
                opacity="1"
                style={{ display: "block" }}
              >
                <g
                  opacity="1"
                  transform="matrix(1,0,0,1,400,666.2360229492188)"
                >
                  <path
                    className="mouth_color"
                    fill={avatarData.colors.mouthColor}
                    fillOpacity="1"
                    d=" M-108.84191131591797,-40.808895111083984 C-108.84191131591797,-40.808895111083984 -3.941159248352051,-6.54134464263916 108.721923828125,-42.43086624145508 C108.721923828125,-42.43086624145508 95.61203002929688,42.728633880615234 2.3820955753326416,43.250328063964844 C-100.49381256103516,43.77442169189453 -108.84191131591797,-40.808895111083984 -108.84191131591797,-40.808895111083984z"
                  ></path>
                </g>
                <g
                  opacity="1"
                  transform="matrix(1,0,0,1,401,722.6404418945312)"
                >
                  <path
                    className="tongue_color"
                    fill={avatarData.colors.tongueColor}
                    fillOpacity="1"
                    d=" M0,-40.27750015258789 C51.333045959472656,-40.27750015258789 93.0114974975586,-22.22915267944336 93.0114974975586,0 C93.0114974975586,22.22915267944336 51.333045959472656,40.27750015258789 0,40.27750015258789 C-51.333045959472656,40.27750015258789 -93.0114974975586,22.22915267944336 -93.0114974975586,0 C-93.0114974975586,-22.22915267944336 -51.333045959472656,-40.27750015258789 0,-40.27750015258789z"
                  ></path>
                  <path
                    strokeLinecap="butt"
                    strokeLinejoin="miter"
                    fillOpacity="0"
                    strokeMiterlimit="4"
                    stroke={avatarData.colors.tongueColor}
                    strokeOpacity="1"
                    strokeWidth="0"
                    d=" M0,-40.27750015258789 C51.333045959472656,-40.27750015258789 93.0114974975586,-22.22915267944336 93.0114974975586,0 C93.0114974975586,22.22915267944336 51.333045959472656,40.27750015258789 0,40.27750015258789 C-51.333045959472656,40.27750015258789 -93.0114974975586,22.22915267944336 -93.0114974975586,0 C-93.0114974975586,-22.22915267944336 -51.333045959472656,-40.27750015258789 0,-40.27750015258789z"
                  ></path>
                </g>
                <g
                  className="teeth_fangs"
                  opacity="1"
                  transform="matrix(1,0,0,1,0,-3)"
                >
                  <g
                    opacity="1"
                    transform="matrix(1,0,0,1,451.9700012207031,645.9249877929688)"
                  >
                    <path
                      className="teeth_color"
                      fill={avatarData.colors.teethColor}
                      fillOpacity="1"
                      d=" M7.675000190734863,-11.654999732971191 C7.675000190734863,-11.654999732971191 5.4730000495910645,1.9910000562667847 -2.934999942779541,9.961999893188477 C-4.7220001220703125,11.656000137329102 -7.675000190734863,10.380000114440918 -7.669000148773193,7.918000221252441 C-7.669000148773193,7.918000221252441 -7.625999927520752,-11.654999732971191 -7.625999927520752,-11.654999732971191 C-7.625999927520752,-11.654999732971191 7.675000190734863,-11.654999732971191 7.675000190734863,-11.654999732971191z"
                    ></path>
                  </g>
                  <g
                    opacity="1"
                    transform="matrix(1,0,0,1,348.0299987792969,645.9249877929688)"
                  >
                    <path
                      className="teeth_color"
                      fill={avatarData.colors.teethColor}
                      fillOpacity="1"
                      d=" M-7.675000190734863,-11.654999732971191 C-7.675000190734863,-11.654999732971191 -5.4730000495910645,1.9910000562667847 2.934999942779541,9.961999893188477 C4.7220001220703125,11.656000137329102 7.675000190734863,10.380000114440918 7.669000148773193,7.918000221252441 C7.669000148773193,7.918000221252441 7.625999927520752,-11.654999732971191 7.625999927520752,-11.654999732971191 C7.625999927520752,-11.654999732971191 -7.675000190734863,-11.654999732971191 -7.675000190734863,-11.654999732971191z"
                    ></path>
                  </g>
                </g>
                <g
                  className="teeth_buck"
                  opacity="1"
                  transform="matrix(1,0,0,1,400,651.8270263671875)"
                >
                  <path
                    className="teeth_color"
                    fill={avatarData.colors.teethColor}
                    fillOpacity="1"
                    d=" M0,-21.634000778198242 C0,-21.634000778198242 -37.47700119018555,-21.634000778198242 -37.47700119018555,-21.634000778198242 C-37.47700119018555,-21.634000778198242 -27.895999908447266,14.378000259399414 -27.895999908447266,14.378000259399414 C-27.23699951171875,16.856000900268555 -25.280000686645508,18.768999099731445 -22.78700065612793,19.365999221801758 C-17.801000595092773,20.559999465942383 -8.909000396728516,21.634000778198242 0,21.634000778198242 C8.909000396728516,21.634000778198242 17.801000595092773,20.559999465942383 22.78700065612793,19.365999221801758 C25.280000686645508,18.768999099731445 27.23699951171875,16.856000900268555 27.895999908447266,14.378000259399414 C27.895999908447266,14.378000259399414 37.47700119018555,-21.634000778198242 37.47700119018555,-21.634000778198242 C37.47700119018555,-21.634000778198242 0,-21.634000778198242 0,-21.634000778198242z"
                  ></path>
                </g>
                <g
                  className="teeth_normal"
                  opacity="1"
                  transform="matrix(1,0,0,1,400.51800537109375,640.333984375)"
                >
                  <path
                    className="teeth_color"
                    fill={avatarData.colors.teethColor}
                    fillOpacity="1"
                    d=" M-83.76799774169922,-25.30299949645996 C-83.76799774169922,-25.30299949645996 -79.41400146484375,-1.7079999446868896 -76.43000030517578,5.449999809265137 C-75.23999786376953,8.305000305175781 -51.65700149536133,25.30299949645996 0,25.30299949645996 C30.132999420166016,25.30299949645996 50.952999114990234,19.863000869750977 50.952999114990234,19.863000869750977 C50.952999114990234,19.863000869750977 58.207000732421875,3.9730000495910645 58.207000732421875,3.9730000495910645 C58.207000732421875,3.9730000495910645 58.207000732421875,17.790000915527344 58.207000732421875,17.790000915527344 C58.207000732421875,17.790000915527344 71.08300018310547,12.980999946594238 76.38800048828125,8.79800033569336 C79.18399810791016,6.5929999351501465 83.76799774169922,-25.30299949645996 83.76799774169922,-25.30299949645996 C83.76799774169922,-25.30299949645996 -83.76799774169922,-25.30299949645996 -83.76799774169922,-25.30299949645996z"
                  ></path>
                </g>
              </g>
              <g
                opacity="1"
                //   transform="matrix(1,0,0,1,0,-6.21240234375)"
                className="avatar-eye-animation "
                style={{ display: "block" }}
              >
                <g
                  opacity="1"
                  transform="matrix(1,0,0,1,523.676025390625,455.6820068359375)"
                >
                  <path
                    className="right_eye_border_color"
                    fill={avatarData.colors.eyeBorderColor}
                    fillOpacity="1"
                    d=" M-79.35700225830078,0 C-79.35700225830078,-43.827999114990234 -43.82699966430664,-79.35800170898438 0.0010000000474974513,-79.35800170898438 C43.82899856567383,-79.35800170898438 79.35700225830078,-43.827999114990234 79.35700225830078,0 C79.35700225830078,43.827999114990234 43.82899856567383,79.35800170898438 0.0010000000474974513,79.35800170898438 C-43.82699966430664,79.35800170898438 -79.35700225830078,43.827999114990234 -79.35700225830078,0z"
                  ></path>
                </g>
                <g
                  opacity="1"
                  transform="matrix(1,0,0,1,517.968994140625,461.3580017089844)"
                >
                  <path
                    className="right_eyeball_color"
                    fill="rgb(255,255,255)"
                    fillOpacity="1"
                    d=" M-69.39399719238281,0 C-69.39399719238281,-38.32500076293945 -38.32600021362305,-69.39299774169922 -0.0010000000474974513,-69.39299774169922 C38.32400131225586,-69.39299774169922 69.39299774169922,-38.32500076293945 69.39299774169922,0 C69.39299774169922,38.32500076293945 38.32400131225586,69.39299774169922 -0.0010000000474974513,69.39299774169922 C-38.32600021362305,69.39299774169922 -69.39399719238281,38.32500076293945 -69.39399719238281,0z"
                  ></path>
                </g>
                <g
                  opacity="1"
                  transform="matrix(1,0,0,1,506.5669860839844,461.3580017089844)"
                >
                  <path
                    className="right_eye_pupil_color"
                    fill={avatarData.colors.pupilColor}
                    fillOpacity="1"
                    d=" M-33.28099822998047,0 C-33.28099822998047,-18.381000518798828 -18.3799991607666,-33.28200149536133 0.0010000000474974513,-33.28200149536133 C18.381000518798828,-33.28200149536133 33.28099822998047,-18.381000518798828 33.28099822998047,0 C33.28099822998047,18.381000518798828 18.381000518798828,33.28200149536133 0.0010000000474974513,33.28200149536133 C-18.3799991607666,33.28200149536133 -33.28099822998047,18.381000518798828 -33.28099822998047,0z"
                  ></path>
                </g>
              </g>
              <g
                //   transform="matrix(1,0,0,1,0,-6.21240234375)"
                className="avatar-eye-animation "
                opacity="1"
                style={{ display: "block" }}
              >
                <g
                  opacity="1"
                  transform="matrix(1,0,0,1,276.3240051269531,455.6820068359375)"
                >
                  <path
                    className="left_eye_border_color"
                    fill={avatarData.colors.eyeBorderColor}
                    fillOpacity="1"
                    d=" M79.35700225830078,0 C79.35700225830078,-43.827999114990234 43.82699966430664,-79.35800170898438 -0.0010000000474974513,-79.35800170898438 C-43.82899856567383,-79.35800170898438 -79.35800170898438,-43.827999114990234 -79.35800170898438,0 C-79.35800170898438,43.827999114990234 -43.82899856567383,79.35800170898438 -0.0010000000474974513,79.35800170898438 C43.82699966430664,79.35800170898438 79.35700225830078,43.827999114990234 79.35700225830078,0z"
                  ></path>
                </g>
                <g
                  opacity="1"
                  transform="matrix(1,0,0,1,282.031005859375,461.3580017089844)"
                >
                  <path
                    className="left_eyeball_color"
                    fill={avatarData.colors.eyeballColor}
                    fillOpacity="1"
                    d=" M69.39299774169922,0 C69.39299774169922,-38.32500076293945 38.32500076293945,-69.39299774169922 0,-69.39299774169922 C-38.32500076293945,-69.39299774169922 -69.39399719238281,-38.32500076293945 -69.39399719238281,0 C-69.39399719238281,38.32500076293945 -38.32500076293945,69.39299774169922 0,69.39299774169922 C38.32500076293945,69.39299774169922 69.39299774169922,38.32500076293945 69.39299774169922,0z"
                  ></path>
                </g>
                <g
                  opacity="1"
                  transform="matrix(1,0,0,1,293.4330139160156,461.3580017089844)"
                >
                  <path
                    className="left_eye_pupil_color"
                    fill={avatarData.colors.pupilColor}
                    fillOpacity="1"
                    d=" M33.28099822998047,0 C33.28099822998047,-18.381000518798828 18.3799991607666,-33.28200149536133 -0.0010000000474974513,-33.28200149536133 C-18.381000518798828,-33.28200149536133 -33.28099822998047,-18.381000518798828 -33.28099822998047,0 C-33.28099822998047,18.381000518798828 -18.381000518798828,33.28200149536133 -0.0010000000474974513,33.28200149536133 C18.3799991607666,33.28200149536133 33.28099822998047,18.381000518798828 33.28099822998047,0z"
                  ></path>
                </g>
              </g>
              <g
                transform="matrix(1,0,0,1,0,0)"
                opacity="1"
                style={{ display: "block" }}
              >
                <g
                  opacity="1"
                  className="avatar-animation-eyebrow-right"
                  // transform="matrix(1,0,0,1,519.7620239257812,310.3994445800781)"
                >
                  <path
                    className="right_eyebrow_color"
                    fill={avatarData.colors.eyebrowColor}
                    fillOpacity="1"
                    d=" M-53.305999755859375,-5.485000133514404 C-53.305999755859375,-5.485000133514404 -49.10900115966797,24.972999572753906 -49.10900115966797,24.972999572753906 C-2.7950000762939453,3.6760001182556152 44.18299865722656,29.908000946044922 44.18299865722656,29.908000946044922 C44.18299865722656,29.908000946044922 53.30500030517578,4.447000026702881 53.30500030517578,4.447000026702881 C0.8460000157356262,-29.908000946044922 -53.305999755859375,-5.485000133514404 -53.305999755859375,-5.485000133514404z"
                  ></path>
                </g>
                <g
                  opacity="1"
                  className="avatar-animation-eyebrow-left"
                  // transform="matrix(1,0,0,1,284.4939880371094,310.3994445800781)"
                >
                  <path
                    className="left_eyebrow_color"
                    fill={avatarData.colors.eyebrowColor}
                    fillOpacity="1"
                    d=" M-53.30500030517578,4.447000026702881 C-53.30500030517578,4.447000026702881 -44.18199920654297,29.908000946044922 -44.18199920654297,29.908000946044922 C-44.18199920654297,29.908000946044922 2.7950000762939453,3.6760001182556152 49.10900115966797,24.972999572753906 C49.10900115966797,24.972999572753906 53.305999755859375,-5.485000133514404 53.305999755859375,-5.485000133514404 C53.305999755859375,-5.485000133514404 -0.8460000157356262,-29.909000396728516 -53.30500030517578,4.447000026702881z"
                  ></path>
                </g>
              </g>
            </g>
          </svg>
        </div>
        {chin && <div
        className="w-full rounded-full absolute z-0"
        style={{
          height: "150%",
          top: "85%",
          background: avatarData.colors.bodyColor,
        }}
      ></div>}
      </div>
    </div>
  );
};

export default AnimatedAvatar;
